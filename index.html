<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario Tablets</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Barra de navegación -->
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <i class="fas fa-tablet-alt header-icon"></i>
                <h1>Inventario Tablets</h1>
            </div>
            <div class="header-right">
                <button id="btnSync" class="icon-btn" title="Sincronizar">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button id="btnExport" class="icon-btn" title="Exportar">
                    <i class="fas fa-file-export"></i>
                </button>
                <button id="btnUser" class="icon-btn" title="Usuario">
                    <i class="fas fa-user"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Pantalla de Login -->
    <div id="loginScreen" class="screen active">
        <div class="login-container">
            <div class="login-card">
                <i class="fas fa-tablet-alt login-icon"></i>
                <h2>Inventario Tablets</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail">Correo Electrónico</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Contraseña</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <button type="submit" class="btn-primary">Iniciar Sesión</button>
                </form>
                <p class="login-footer">Sistema de Gestión de Inventario</p>
            </div>
        </div>
    </div>

    <!-- Pantalla Principal - Lista de Tablets -->
    <div id="listScreen" class="screen">
        <div class="container">
            <!-- Barra de búsqueda y filtros -->
            <div class="search-bar">
                <div class="search-input-container">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Buscar por código, serie, modelo...">
                </div>
                <button id="btnFilter" class="btn-secondary">
                    <i class="fas fa-filter"></i> Filtros
                </button>
                <button id="btnAddNew" class="btn-primary">
                    <i class="fas fa-plus"></i> Nuevo
                </button>
            </div>

            <!-- Panel de filtros (inicialmente oculto) -->
            <div id="filterPanel" class="filter-panel hidden">
                <div class="filter-grid">
                    <div class="form-group">
                        <label>Sede</label>
                        <select id="filterSede">
                            <option value="">Todas</option>
                            <option value="Sanarate (EP)">Sanarate (EP)</option>
                            <option value="La Pedrera (LP)">La Pedrera (LP)</option>
                            <option value="San Juan Sacatepéquez (SJ)">San Juan Sacatepéquez (SJ)</option>
                            <option value="Santo Domingo Xenacoj (SDX)">Santo Domingo Xenacoj (SDX)</option>
                            <option value="Sin Sede (N/A)">Sin Sede (N/A)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Estado de Pantalla</label>
                        <select id="filterEstadoPantalla">
                            <option value="">Todos</option>
                            <option value="Bueno">Bueno</option>
                            <option value="Rayado">Rayado</option>
                            <option value="Quebrado">Quebrado</option>
                            <option value="Con manchas">Con manchas</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Estado Puerto de Carga</label>
                        <select id="filterEstadoPuerto">
                            <option value="">Todos</option>
                            <option value="Funciona">Funciona</option>
                            <option value="No Funciona">No Funciona</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Rango de Fechas</label>
                        <input type="date" id="filterFechaInicio">
                        <input type="date" id="filterFechaFin">
                    </div>
                </div>
                <div class="filter-actions">
                    <button id="btnApplyFilters" class="btn-primary">Aplicar</button>
                    <button id="btnClearFilters" class="btn-secondary">Limpiar</button>
                </div>
            </div>

            <!-- Dashboard de estadísticas -->
            <div class="dashboard">
                <div class="stat-card">
                    <i class="fas fa-tablet-alt"></i>
                    <div>
                        <h3 id="totalTablets">0</h3>
                        <p>Total Tablets</p>
                    </div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-check-circle"></i>
                    <div>
                        <h3 id="tabletsOk">0</h3>
                        <p>En Buen Estado</p>
                    </div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>
                        <h3 id="tabletsIssues">0</h3>
                        <p>Con Problemas</p>
                    </div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-battery-half"></i>
                    <div>
                        <h3 id="avgBattery">0%</h3>
                        <p>Batería Promedio</p>
                    </div>
                </div>
            </div>

            <!-- Lista de tablets -->
            <div id="tabletsList" class="tablets-grid">
                <!-- Las tarjetas se generarán dinámicamente -->
            </div>

            <!-- Mensaje de sin resultados -->
            <div id="noResults" class="no-results hidden">
                <i class="fas fa-inbox"></i>
                <p>No se encontraron tablets</p>
            </div>
        </div>
    </div>

    <!-- Pantalla de Formulario (Crear/Editar) -->
    <div id="formScreen" class="screen">
        <div class="container">
            <div class="form-header">
                <button id="btnBack" class="btn-back">
                    <i class="fas fa-arrow-left"></i> Volver
                </button>
                <h2 id="formTitle">Nueva Tablet</h2>
            </div>

            <form id="tabletForm" class="tablet-form">
                                <!-- Fotos de Evidencia -->
                <div class="form-section">
                    <h3>Fotos de Evidencia</h3>
                    <div class="photo-upload-area">
                        <button type="button" id="btnCamera" class="btn-photo">
                            <i class="fas fa-camera"></i> Tomar Foto
                        </button>
                        <button type="button" id="btnGallery" class="btn-photo">
                            <i class="fas fa-image"></i> Desde Galería
                        </button>
                        <button type="button" id="btnScanOCR" class="btn-photo">
                            <i class="fas fa-scan"></i> Escanear Info (OCR)
                        </button>
                        <input type="file" id="fileInput" accept="image/*" multiple hidden>
                        <input type="file" id="cameraInput" accept="image/*" capture="environment" hidden>
                    </div>
                    <div id="photoPreview" class="photo-preview">
                        <!-- Las fotos se mostrarán aquí -->
                    </div>
                </div>

                <!-- Botones de acción -->
                <div class="form-actions">
                    <button type="button" id="btnCancel" class="btn-secondary">Cancelar</button>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-save"></i> Guardar
                    </button>
                </div>
                <!-- Información Básica -->
                <div class="form-section">
                    <h3>Información Básica</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="codigoUnico">Código Único *</label>
                            <input type="text" id="codigoUnico" required>
                            <button type="button" id="btnGenerarCodigo" class="btn-secondary btn-small">
                                <i class="fas fa-magic"></i> Generar
                            </button>
                        </div>
                        <div class="form-group">
                            <label for="numeroSerie">Número de Serie *</label>
                            <input type="text" id="numeroSerie" required>
                        </div>
                        <div class="form-group">
                            <label for="modelo">Modelo *</label>
                            <input type="text" id="modelo" required>
                        </div>
                        <div class="form-group">
                            <label for="nombreProducto">Nombre del Producto</label>
                            <input type="text" id="nombreProducto">
                        </div>
                        <div class="form-group">
                            <label for="sede">Sede de Procedencia *</label>
                            <select id="sede" required>
                                <option value="">Seleccionar sede</option>
                                <option value="Sanarate (EP)">Sanarate (EP)</option>
                                <option value="La Pedrera (LP)">La Pedrera (LP)</option>
                                <option value="San Juan Sacatepéquez (SJ)">San Juan Sacatepéquez (SJ)</option>
                                <option value="Santo Domingo Xenacoj (SDX)">Santo Domingo Xenacoj (SDX)</option>
                                <option value="Sin Sede (N/A)">Sin Sede (N/A)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Información Técnica -->
                <div class="form-section">
                    <h3>Información Técnica</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="versionAndroid">Versión de Android</label>
                            <input type="text" id="versionAndroid" placeholder="Ej: Android 11">
                        </div>
                        <div class="form-group full-width">
                            <label for="nivelBateria">Nivel de Batería (%)</label>
                            <input type="range" id="nivelBateria" min="0" max="100" value="0">
                            <div class="battery-display">
                                <input type="number" id="nivelBateriaNum" min="0" max="100" value="0">
                                <span class="battery-percentage">0%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Estado del Dispositivo -->
                <div class="form-section">
                    <h3>Estado del Dispositivo</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="estadoPantalla">Estado de Pantalla *</label>
                            <select id="estadoPantalla" required>
                                <option value="Bueno">Bueno</option>
                                <option value="Rayado">Rayado</option>
                                <option value="Quebrado">Quebrado</option>
                                <option value="Con manchas">Con manchas</option>
                                <option value="Otro">Otro (especificar)</option>
                            </select>
                        </div>
                        <div class="form-group hidden" id="estadoPantallaOtroGroup">
                            <label for="estadoPantallaOtro">Especificar Estado</label>
                            <input type="text" id="estadoPantallaOtro">
                        </div>
                        <div class="form-group">
                            <label for="estadoPuertoCarga">Estado del Puerto de Carga *</label>
                            <select id="estadoPuertoCarga" required>
                                <option value="Funciona">Funciona</option>
                                <option value="No Funciona">No Funciona</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="estadoFisicoGeneral">Estado Físico General *</label>
                            <select id="estadoFisicoGeneral" required>
                                <option value="Excelente">Excelente</option>
                                <option value="Bueno">Bueno</option>
                                <option value="Regular">Regular</option>
                                <option value="Malo">Malo</option>
                            </select>
                        </div>
                        <div class="form-group full-width">
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="tieneCargador">
                                    <span>Tiene cargador</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="tieneCableCarga">
                                    <span>Tiene cable de carga</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Observaciones -->
                <div class="form-section">
                    <h3>Observaciones y Mantenimiento</h3>
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label for="observacionesAdicionales">Observaciones Adicionales</label>
                            <textarea id="observacionesAdicionales" rows="3"></textarea>
                        </div>
                        <div class="form-group full-width">
                            <label for="hallazgosRelevantes">Hallazgos Relevantes</label>
                            <textarea id="hallazgosRelevantes" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="fechaMantenimiento">Fecha de Mantenimiento *</label>
                            <input type="date" id="fechaMantenimiento" required>
                        </div>
                    </div>
                </div>


            </form>
        </div>
    </div>

    <!-- Modal de detalles de tablet -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="detailTitle">Detalles de Tablet</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div id="detailBody" class="modal-body">
                <!-- Los detalles se cargarán dinámicamente -->
            </div>
            <div class="modal-footer">
                <button id="btnEdit" class="btn-primary">
                    <i class="fas fa-edit"></i> Editar
                </button>
                <button id="btnDelete" class="btn-danger">
                    <i class="fas fa-trash"></i> Eliminar
                </button>
                <button id="btnViewHistory" class="btn-secondary">
                    <i class="fas fa-history"></i> Historial
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de cámara/OCR -->
    <div id="cameraModal" class="modal">
        <div class="modal-content camera-modal">
            <div class="modal-header">
                <h2>Capturar Información</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <video id="cameraVideo" autoplay playsinline></video>
                <canvas id="cameraCanvas" hidden></canvas>
                <div id="ocrResult" class="ocr-result hidden">
                    <h3>Información Detectada:</h3>
                    <div id="ocrText"></div>
                    <button id="btnApplyOCR" class="btn-primary">Aplicar a Formulario</button>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btnCapture" class="btn-primary">
                    <i class="fas fa-camera"></i> Capturar
                </button>
                <button id="btnCancelCamera" class="btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Loader -->
    <div id="loader" class="loader hidden">
        <div class="spinner"></div>
        <p>Cargando...</p>
    </div>

    <!-- Toast notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Scripts - ORDEN IMPORTANTE -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.0.4/dist/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Scripts de la aplicación - DEBEN IR DESPUÉS -->
    <script src="js/supabase-client.js"></script>
    <script src="js/ocr-handler.js"></script>
    <script src="js/camera.js"></script>
    <script src="js/reports.js"></script>
    <script src="js/app.js"></script>
</body>
</html>

